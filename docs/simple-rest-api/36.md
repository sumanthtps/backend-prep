---
id: jpa-sql-logging
title: Viewing SQL Queries with JPA
sidebar_label: JPA SQL Logging
---

## üîç Goal

In this module, we‚Äôll:

- Use `spring.jpa.show-sql=true` to view SQL queries executed by JPA/Hibernate.
- Understand which SQL statements get triggered during various REST API calls.
- Explore how insert operations and sequences work in Hibernate.

---

## ‚öôÔ∏è Enable SQL Logging

Update your `application.properties`:

```properties
spring.jpa.show-sql=true
```

This logs every SQL query triggered by your application to the console.

---

## üì• Fetch All Users

### ‚ûï Request

```
GET /jpa/users
```

### üîÑ SQL Output

```sql
select id, birth_date, name from user_details;
```

### üß† Behind the Scenes

This is triggered by:

```java
userRepository.findAll();
```

---

## üì• Fetch Posts for a User

### ‚ûï Request

```
GET /jpa/users/10001/posts
```

### üîÑ SQL Output

```sql
select id, birth_date, name from user_details where id=10001;
select user_id, id, description from post where user_id=10001;
```

### üß† Behind the Scenes

This is triggered by:

```java
User user = userRepository.findById(userId).get();
return user.getPosts();
```

> Two SQL statements are generated:
>
> 1. Fetch the user to verify existence.
> 2. Fetch associated posts via foreign key.

---

## ‚ûï Create a New Post

### ‚ûï Request (POST)

```
POST /jpa/users/10001/posts
Content-Type: application/json
{
  "description": "I want to learn Azure Fundamentals"
}
```

### üîÑ SQL Output

```sql
select id, birth_date, name from user_details where id=10001;
call next value for post_sequence;
insert into post (description, id, user_id) values (?, ?, ?);
```

### üß† Behind the Scenes

- Step 1: Confirm the user exists.
- Step 2: Use a sequence to generate the new post ID.
- Step 3: Insert the post with `user_id` as foreign key.

> Hibernate uses the `@SequenceGenerator` to manage post IDs.

---

## üîÑ Add Another Post

### ‚ûï Request (POST)

```json
{
  "description": "I want to get GCP certified"
}
```

### üîÑ SQL Output

```sql
call next value for post_sequence;
insert into post (description, id, user_id) values (?, ?, ?);
```

> Sequence increments (e.g., 2, 3, 4...) as you insert new posts.

---

## üß™ Check in H2 Console

- Visit: `http://localhost:8080/h2-console`
- Connect and run:

```sql
SELECT * FROM POST;
```

You‚Äôll see each post inserted with its auto-generated ID and the associated `user_id`.

---

## üß† Summary

| Operation                    | SQL Statements                                      |
| ---------------------------- | --------------------------------------------------- |
| `GET /jpa/users`             | `SELECT * FROM user_details`                        |
| `GET /jpa/users/{id}/posts`  | `SELECT` from `user_details` + `SELECT` from `post` |
| `POST /jpa/users/{id}/posts` | `SELECT` + `CALL NEXTVAL` + `INSERT INTO post`      |

---

## üí° Tip

Want more verbose SQL with parameter values?

```properties
spring.jpa.properties.hibernate.format_sql=true
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
```

---

## üßê Mini Quiz

1. What does `spring.jpa.show-sql` do?
2. Why are there two queries in `GET /jpa/users/10001/posts`?
3. How does Hibernate generate IDs for new posts?

**Answers:**

1. It enables logging of raw SQL queries.
2. One for the user entity, one for their associated posts.
3. Uses a `@SequenceGenerator` and calls `next value for post_sequence`.

---
