# Enhancing POST - 1

## ğŸš€ **Enhancing `POST /users` API with `201 Created` and Location Header**

In this step, we improved our `POST` API to:  
âœ… Return **201 Created** instead of 200.  
âœ… Include a **Location Header** pointing to the newly created resource.

---

## ğŸ”¹ **Step 1: Update `UserResource` (Controller Layer)**

### ğŸ“Œ **Code:**

```java
@PostMapping
public ResponseEntity<User> createUser(@RequestBody User user) {
    User savedUser = service.saveUser(user);

    // Construct the Location URI for the newly created user
    URI location = ServletUriComponentsBuilder.fromCurrentRequest()
            .path("/{id}")
            .buildAndExpand(savedUser.getId())
            .toUri();

    // Return 201 Created with the Location header
    return ResponseEntity.created(location).body(savedUser);
}
```

---

## ğŸ”¹ **Step 2: Understanding `ResponseEntity.created(location)`**

### âœ… **Why use `201 Created` instead of `200 OK`?**

- `200 OK` â†’ Used when a request succeeds but **does not create a new
  resource**.
- `201 Created` â†’ **Correct status** when a new resource is created.

### âœ… **What is the `Location` header?**

- Tells the client **where** to find the new resource.
- Example:
  ```http
  Location: http://localhost:8080/users/4
  ```
- This allows clients to **immediately fetch the new user**.

---

## ğŸ”¹ **Step 3: How Does `ServletUriComponentsBuilder` Work?**

```java
URI location = ServletUriComponentsBuilder.fromCurrentRequest()
        .path("/{id}")
        .buildAndExpand(savedUser.getId())
        .toUri();
```

ğŸ“Œ **Breakdown:** 1ï¸âƒ£ **`fromCurrentRequest()`** â†’ Captures the **current request
URL** (`/users`).  
2ï¸âƒ£ **`path("/{id}")`** â†’ Appends `/{id}` to it.  
3ï¸âƒ£ **`buildAndExpand(savedUser.getId())`** â†’ Replaces `{id}` with the **new
userâ€™s ID**.  
4ï¸âƒ£ **`.toUri()`** â†’ Converts it into a `URI` object.

ğŸ“Œ **Example:**  
If the request was `POST /users`, and the new userâ€™s ID is `4`:  
ğŸ”¹ **Generated URI** â†’ `http://localhost:8080/users/4`

---

## ğŸ”¹ **Step 4: Testing the API**

### **1ï¸âƒ£ Send a `POST` request to create a user**

ğŸ“Œ **Request:**

```http
POST http://localhost:8080/users
Content-Type: application/json
```

ğŸ“Œ **Body (JSON):**

```json
{
  "name": "Ravi",
  "birthDate": "1995-01-01"
}
```

ğŸ“Œ **Response:**

```
201 Created
Location: http://localhost:8080/users/4
```

---

### **2ï¸âƒ£ Verify by retrieving the new user**

ğŸ“Œ **Request:**

```http
GET http://localhost:8080/users/4
```

ğŸ“Œ **Response (JSON):**

```json
{
  "id": 4,
  "name": "Ravi",
  "birthDate": "1995-01-01"
}
```

âœ… **User successfully created and retrieved!**

---

## â“ **Q&A Section**

### **1ï¸âƒ£ Why do we need `Location` header?**

- It helps **API consumers** to know **where** to find the newly created
  resource.
- Without it, clients must guess or manually construct the URL.

---

### **2ï¸âƒ£ What happens if the user is not found?**

- **Returns `404 Not Found`**:
  ```java
  @GetMapping("/{id}")
  public ResponseEntity<User> retrieveUser(@PathVariable int id) {
      User user = service.findOne(id);
      if (user == null) {
          return ResponseEntity.notFound().build();
      }
      return ResponseEntity.ok(user);
  }
  ```

---

### **3ï¸âƒ£ What if an invalid request is sent?**

- **Returns `400 Bad Request` for validation errors**.
- We will later add `@Valid` and `@NotNull` for input validation.

---

## ğŸ¯ **Final Thoughts**

âœ… **Used `ResponseEntity.created(location)` for `201 Created`.**  
âœ… **Added `Location` header pointing to the new user.**  
âœ… **Improved API usability for consumers.**

ğŸ“Œ **Next Steps:**

- **Add Validation** (`@Valid`, `@NotNull`, `@Past`)
- **Handle DELETE API** (`@DeleteMapping`)
- **Connect to a Database using JPA & Hibernate**

Let me know if you have any questions! ğŸš€
