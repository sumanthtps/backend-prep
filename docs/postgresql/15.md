---
sidebar_position: 15
---
# PostgreSQL Security & Access Control
Security in PostgreSQL is crucial for **protecting data** from unauthorized access. PostgreSQL provides **role-based access control (RBAC), encryption, and row-level security (RLS)** to enforce strict access policies.  

---

## **1Ô∏è‚É£ Roles & Privileges (`CREATE ROLE`)**
PostgreSQL uses **roles** to manage user permissions. A **role** can be a **user** or a **group** of users.  

‚úÖ **Creating a New Role (User)**  
```sql
CREATE ROLE dev_user WITH LOGIN PASSWORD 'securepass';
```
‚úî **Creates a new database user (`dev_user`) with a password**.  

‚úÖ **Granting Database Access to a Role**  
```sql
GRANT CONNECT ON DATABASE mydb TO dev_user;
```
‚úî **Allows `dev_user` to connect to `mydb`**.  

‚úÖ **Granting Read & Write Access**  
```sql
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE users TO dev_user;
```
‚úî **Allows `dev_user` to read and modify data in the `users` table**.  

‚úÖ **Revoking Access**  
```sql
REVOKE INSERT, UPDATE ON users FROM dev_user;
```
‚úî **Removes write access from `dev_user`**.  

---

## **2Ô∏è‚É£ Superusers vs. Regular Users**
| Role Type     | Description |
|--------------|-------------|
| **Superuser** | Full control over PostgreSQL (`postgres` by default) |
| **Regular User** | Limited privileges (only what is granted) |
| **Group Role** | Collection of users with shared permissions |

üöÄ **Creating a Group Role (`developers`)**  
```sql
CREATE ROLE developers;
GRANT developers TO dev_user;
```
‚úî Now, `dev_user` **inherits all permissions** from `developers`.  

---

## **3Ô∏è‚É£ Row-Level Security (RLS)**
Row-Level Security (RLS) **restricts access to specific rows in a table** based on conditions.  

‚úÖ **Step 1: Enable RLS on a Table**  
```sql
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
```
üöÄ **Now, all users are denied access unless explicitly allowed!**  

‚úÖ **Step 2: Define an RLS Policy (User Can Only See Their Own Data)**  
```sql
CREATE POLICY user_data_policy ON users
USING (id = current_user_id());
```
‚úî Users **can only see rows where `id` matches their user ID**.  

‚úÖ **Step 3: Apply the Policy**  
```sql
ALTER TABLE users FORCE ROW LEVEL SECURITY;
```
‚úî **Forces RLS for all queries** (even for admins unless explicitly exempted).  

---

## **4Ô∏è‚É£ Database Encryption (SSL)**
‚úî **PostgreSQL supports SSL encryption** to secure data during transmission.  

‚úÖ **Check if SSL is Enabled**  
```sql
SHOW ssl;
```
‚úî If `off`, SSL is **not enabled**.  

‚úÖ **Force SSL Connection (pg_hba.conf)**  
```conf
hostssl all all 0.0.0.0/0 md5
```
‚úî **Ensures that all connections use SSL.**  

---

## **5Ô∏è‚É£ Auditing & Logging (pgAudit)**
‚úî Use `pgAudit` for **tracking queries, logins, and security events**.  

‚úÖ **Enable Query Logging**  
```sql
ALTER SYSTEM SET log_statement = 'all';
SELECT pg_reload_conf();
```
‚úî Logs **every SQL query** in PostgreSQL.  

‚úÖ **Enable `pgAudit` Extension**  
```sql
CREATE EXTENSION pgaudit;
ALTER SYSTEM SET pgaudit.log = 'read, write';
SELECT pg_reload_conf();
```
‚úî **Tracks all read (`SELECT`) and write (`INSERT, UPDATE, DELETE`) operations**.  

---

## **üìù Quiz - PostgreSQL Security & Access Control**
1Ô∏è‚É£ What is the difference between a **role** and a **user** in PostgreSQL?  
2Ô∏è‚É£ How do you grant `SELECT` and `UPDATE` privileges on a table to a user?  
3Ô∏è‚É£ What does **Row-Level Security (RLS)** do?  
4Ô∏è‚É£ How can you check if SSL is enabled in PostgreSQL?  
5Ô∏è‚É£ What extension is used for **auditing queries and security events**?  

Drop your answers, and we‚Äôll move to the next advanced topic! üöÄ