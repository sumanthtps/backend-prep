---
sidebar_position: 14
---
# Advanced JSON & JSONB
PostgreSQL provides **powerful support for JSON and JSONB** data types, making it ideal for **semi-structured data storage and retrieval**.  

---

## **1ï¸âƒ£ Difference Between `JSON` and `JSONB`**
| Feature    | `JSON` | `JSONB` |
|------------|--------|--------|
| Storage Type | Text-based (raw JSON) | Binary format |
| Read Performance | Slow (needs re-parsing) | Fast (pre-parsed, indexed) |
| Indexing | âŒ No Index Support | âœ… Supports GIN/BTREE indexes |
| Modification | âŒ Cannot modify fields efficiently | âœ… Supports partial updates |

ğŸš€ **Best Practice:** âœ… **Always use `JSONB`** unless you need to store raw JSON for exact formatting.  

âœ… **Example (Storing JSON Data in a Table)**  
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    details JSONB -- Stores flexible user data
);
```

âœ… **Inserting JSONB Data**  
```sql
INSERT INTO users (details) 
VALUES ('{"name": "Alice", "age": 25, "skills": ["SQL", "PostgreSQL"]}');
```

---

## **2ï¸âƒ£ Querying JSONB Data**
### **Extracting Fields**
âœ… **Get a JSON field (`->`)**  
```sql
SELECT details->'name' FROM users;
```
âœ” Returns: `"Alice"` (as JSON)  

âœ… **Get a JSON field as text (`->>`)**  
```sql
SELECT details->>'name' FROM users;
```
âœ” Returns: `Alice` (as TEXT)  

âœ… **Query Nested JSON Fields (`#>` and `#>>`)**  
```sql
SELECT details#>'{skills, 0}' FROM users;
```
âœ” Returns: `"SQL"` (Accesses first skill in the array)  

---

## **3ï¸âƒ£ Searching Inside JSONB**
âœ… **Check if JSON contains a value (`@>`)**  
```sql
SELECT * FROM users WHERE details @> '{"age": 25}';
```
âœ” Finds **users with age = 25**  

âœ… **Search for a key (`?`)**  
```sql
SELECT * FROM users WHERE details ? 'skills';
```
âœ” Finds **users who have a "skills" key in their JSON**  

âœ… **Search for a value inside an array (`?|` and `?&`)**  
```sql
SELECT * FROM users WHERE details->'skills' ?| ARRAY['SQL', 'Java'];
```
âœ” Finds users with **either "SQL" or "Java"** in `skills`  

```sql
SELECT * FROM users WHERE details->'skills' ?& ARRAY['SQL', 'Java'];
```
âœ” Finds users with **both "SQL" and "Java"**  

---

## **4ï¸âƒ£ Updating JSONB Data**
âœ… **Adding a New Field (`jsonb_set`)**  
```sql
UPDATE users 
SET details = jsonb_set(details, '{city}', '"New York"');
```
âœ” Adds `"city": "New York"` to JSON  

âœ… **Updating a Nested Value**  
```sql
UPDATE users 
SET details = jsonb_set(details, '{age}', '30');
```
âœ” Updates `"age"` field to `30`  

âœ… **Removing a Field (`-` Operator)**  
```sql
UPDATE users 
SET details = details - 'age';
```
âœ” Removes `"age"` field from JSON  

---

## **5ï¸âƒ£ Indexing JSONB for Performance**
Since `JSONB` allows indexing, we can speed up queries significantly.  

âœ… **Create a GIN Index for Faster Searches**  
```sql
CREATE INDEX idx_users_details ON users USING GIN (details);
```
âœ” Boosts performance for queries like:  
```sql
SELECT * FROM users WHERE details @> '{"age": 25}';
```

âœ… **Create a BTREE Index for a Specific JSON Field**  
```sql
CREATE INDEX idx_users_age ON users ((details->>'age'));
```
âœ” Speeds up queries filtering by `"age"`  

---

## **6ï¸âƒ£ Best Practices for JSONB**
âœ” **Use `JSONB` instead of `JSON`** for indexing and performance.  
âœ” **Avoid deep nesting**â€”harder to query and index.  
âœ” **Create indexes** for frequently queried keys.  
âœ” **Use `jsonb_set()` for updates instead of rewriting entire JSON objects.**  
âœ” **For relational data, use regular columns instead of JSON!**  

---

## **ğŸ“ Quiz - Advanced JSON & JSONB**
1ï¸âƒ£ What is the key difference between `JSON` and `JSONB`?  
2ï¸âƒ£ How do you extract a **JSON field as text**?  
3ï¸âƒ£ How can you **search for a key** in JSONB?  
4ï¸âƒ£ What function is used to update a JSONB field?  
5ï¸âƒ£ Which index type is best for JSONB searches?  

Drop your answers, and weâ€™ll move to the next advanced topic! ğŸš€