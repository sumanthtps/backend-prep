---
sidebar_position: 6
---
# Transactions & Concurrency Control
A **transaction** is a sequence of database operations that **execute as a single unit**. Transactions ensure **data consistency** and follow the **ACID properties**.

---

## **1Ô∏è‚É£ ACID Properties in PostgreSQL**
| Property      | Description |
|--------------|-------------|
| **Atomicity**  | All operations in a transaction succeed or none do. |
| **Consistency** | The database remains in a valid state before & after a transaction. |
| **Isolation** | Transactions do not interfere with each other. |
| **Durability** | Committed transactions are permanently saved (even after a crash). |

‚úÖ **Example:** A banking transaction **must follow ACID**:  
```sql
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```
- If one `UPDATE` fails, **everything rolls back** to prevent inconsistencies.

---

## **2Ô∏è‚É£ COMMIT & ROLLBACK**  
- `COMMIT`: **Saves** all changes made in the transaction.  
- `ROLLBACK`: **Undoes** all changes made in the transaction.  

‚úÖ **Example:**  
```sql
BEGIN;
UPDATE users SET balance = balance - 50 WHERE id = 1;
UPDATE users SET balance = balance + 50 WHERE id = 2;
COMMIT; -- Saves changes permanently
```
üöÄ **If an error occurs, rollback everything:**  
```sql
BEGIN;
UPDATE users SET balance = balance - 50 WHERE id = 1;
UPDATE users SET balance = balance + 50 WHERE id = 2;
ROLLBACK; -- Reverts all changes
```

---

## **3Ô∏è‚É£ SAVEPOINT (Nested Transactions)**
- `SAVEPOINT` allows **partial rollbacks** inside a transaction.  
- **Useful for handling errors within a large transaction.**  

‚úÖ **Example:**  
```sql
BEGIN;
UPDATE users SET balance = balance - 100 WHERE id = 1;
SAVEPOINT sp1;
UPDATE users SET balance = balance + 100 WHERE id = 2;

-- If an issue occurs, rollback only to SAVEPOINT
ROLLBACK TO sp1;

-- Continue other operations
COMMIT;
```

---

## **4Ô∏è‚É£ Isolation Levels (Preventing Data Conflicts)**
Isolation levels define **how transactions interact** with each other. PostgreSQL supports **4 isolation levels**:  

| Isolation Level | Prevents Dirty Reads? | Prevents Non-Repeatable Reads? | Prevents Phantom Reads? |
|----------------|----------------------|------------------------------|------------------------|
| `READ UNCOMMITTED` | ‚ùå No | ‚ùå No | ‚ùå No |
| `READ COMMITTED` (Default) | ‚úÖ Yes | ‚ùå No | ‚ùå No |
| `REPEATABLE READ` | ‚úÖ Yes | ‚úÖ Yes | ‚ùå No |
| `SERIALIZABLE` | ‚úÖ Yes | ‚úÖ Yes | ‚úÖ Yes |

### **‚ö° Isolation Level Examples**
üîπ **READ COMMITTED (Default)** ‚Äì Only reads **committed transactions** but can see different results in the same transaction.  
‚úÖ **Example:**  
```sql
BEGIN;
SELECT balance FROM accounts WHERE id = 1;
-- Another transaction updates balance here
SELECT balance FROM accounts WHERE id = 1; -- Might get a different value
COMMIT;
```

üîπ **REPEATABLE READ** ‚Äì Ensures the **same result** in a transaction but allows **phantom reads**.  
‚úÖ **Example:**  
```sql
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
BEGIN;
SELECT COUNT(*) FROM users;
-- Another transaction inserts new users
SELECT COUNT(*) FROM users; -- Still shows the old count
COMMIT;
```

üîπ **SERIALIZABLE** ‚Äì The **strictest level**, preventing all anomalies but reducing concurrency.  

‚úÖ **Example:**  
```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN;
-- Conflicting updates will be prevented
COMMIT;
```

---

## **üìù Quiz - Transactions & Concurrency**
1Ô∏è‚É£ What is the purpose of a transaction in PostgreSQL?  
2Ô∏è‚É£ What does `ROLLBACK` do in a transaction?  
3Ô∏è‚É£ How does `SAVEPOINT` help in a transaction?  
4Ô∏è‚É£ What is the default isolation level in PostgreSQL?  
5Ô∏è‚É£ Which isolation level prevents all anomalies?  

Drop your answers, and we‚Äôll move forward! üöÄ