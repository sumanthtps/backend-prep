---
id: setting-container-limits
title: Setting Container Limits ":" Part 1
sidebar_label: Setting Container Limits
sidebar_position: 61
---

## Summary

This section focuses on **resource limiting in Docker containers** using Linux
**control groups (cgroups)** to prevent individual containers from consuming
excessive CPU or memory resources. It emphasizes how uncontrolled containers can
cause memory starvation or system slowdowns, and explains Docker’s options like
`--cpus`, `--memory`, `--cpu-quota`, and `--cpu-period`.

---

## Key Concepts Explained

### 🔒 Why Set Container Limits?

- Docker containers share resources on the host.
- A single memory-leaking or CPU-hogging container can:
  - Crash other containers
  - Starve them of memory/CPU
  - Cause downtime or degraded performance

### 🧠 How Linux Cgroups Help

- **Namespaces** control _what_ a container can see.
- **Control groups (cgroups)** control _how much_ it can use.

### 🛠️ Docker Options for Limits

| Option         | Purpose                                 | Example               |
| -------------- | --------------------------------------- | --------------------- |
| `--memory`     | Sets max memory (RAM) in bytes          | `--memory=128m`       |
| `--cpus`       | Sets CPU time as a decimal              | `--cpus=1.5`          |
| `--cpu-quota`  | Max microseconds of CPU time per period | `--cpu-quota=50000`   |
| `--cpu-period` | Time window in microseconds             | `--cpu-period=100000` |

---

## 💡 CPU Resource Allocation Internals

CPU control is more granular than just “use X CPUs”. Here's how it works:

### 🧮 CPU Period and Quota

- **CPU Period**: How often the scheduler checks (in µs)
- **CPU Quota**: How much time the container gets (in µs)

Example:

```txt
--cpu-period=100000
--cpu-quota=50000
```

→ This container gets 50% of CPU time every 100ms.

> Docker simplifies this with `--cpus`. Example: `--cpus=1.4`

### 🔁 Multi-CPU Consideration

If you move from 1 CPU to 2 CPUs:

- The total available compute doubles.
- You must increase quota accordingly to maintain the **same % of total power**.

#### Calculation Logic

| CPUs | Period    | Quota   | Equivalent `--cpus` |
| ---- | --------- | ------- | ------------------- |
| 1    | 1,000,000 | 400,000 | 0.4                 |
| 2    | 1,000,000 | 800,000 | 0.8                 |
| 2    | 100,000   | 140,000 | 1.4                 |

---

## 🖼️ Helpful Diagram

**How CPU Period & Quota work**

![CPU Quota and Period Illustration](https://upload.wikimedia.org/wikipedia/commons/3/35/Cgroups_cpu_quota_period.svg)

> Source: [Wikipedia – Cgroups](https://en.wikipedia.org/wiki/Cgroups)

---

## 🧪 Practical Example

```bash
docker run --cpus=1.5 --memory=128m alpine stress --cpu 2
```

This limits the container to:

- 1.5 CPUs
- 128 MB memory

---

## ✅ Best Practices

- Use `--memory` **always** in production. Prevents OOM issues.
- Use `--cpus` for simple percentage-based limits.
- Use `--cpu-quota`/`--cpu-period` only when you need **fine-tuned control**.
- Monitor your containers using `docker stats`.

---

## ❓Questions to Think About

1. Why is `--cpus` preferred over manually setting `--cpu-quota` and
   `--cpu-period`?
2. What would happen if you set `--memory=64m` but your app tries to use 200MB?
3. In a system with 4 CPUs, how would you configure a container to use only 1
   full core?

---

## 📌 Notes

- `--memory` triggers **OOM killer** if exceeded.
- `--cpus` is **not a hard limit**, but a share.
- On multi-core systems, quotas must account for total available compute.
- This topic sets up for more advanced orchestration topics (e.g., Kubernetes
  resource limits).

```

```
