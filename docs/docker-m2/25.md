---

title: Adding Variables with ENV and ARG
sidebar_position: 52
---------------------

## Overview

As we customize our Docker images further, we often want flexibility:

* Choosing which **package version** to install at build time
* Passing **default values** or **configurations** to containers at run time

Docker provides two mechanisms for this:

* `ARG` ‚Äî Build-time variables
* `ENV` ‚Äî Run-time environment variables

They may look similar but behave **very differently**.

---

## üÜö ENV vs ARG ‚Äî Core Differences

| Feature                  | `ARG`                           | `ENV`                                    |
| ------------------------ | ------------------------------- | ---------------------------------------- |
| Scope                    | Available **only during build** | Available **during runtime** (and build) |
| Visibility in containers | ‚ùå Not available in containers  | ‚úÖ Available in running containers       |
| Can override at build    | ‚úÖ Yes (`--build-arg`)          | ‚ùå No                                    |
| Can override at runtime  | ‚ùå No                           | ‚úÖ Yes (`--env` or `-e`)                 |
| Can set default value    | ‚úÖ Yes                          | ‚úÖ Yes                                   |

---

## üß™ Step-by-Step: Using `ARG`

### Dockerfile

```dockerfile
ARG curl_bin="curl"

RUN apt -y update && apt -y install $curl_bin
```

This tells Docker:

- Use `$curl_bin` during build
- If no value passed, use `"curl"`

### Building the image with custom value

```bash
docker build --build-arg curl_bin=curl -t my-image .
```

You can also try:

```bash
docker build --build-arg curl_bin=invalid -t my-image .
```

üî¥ This **fails** ‚Äî because `invalid` is not a real package.

> `ARG` is like a **parameter** passed to the `Dockerfile` at build time.

---

## ‚ùå ARG is Not Available at Runtime

Try this command to inspect the value of `curl_bin`:

```bash
docker run --rm --entrypoint sh my-image -c 'echo $curl_bin'
```

**Output:** (empty)

‚û°Ô∏è Because `ARG` does **not** persist into the final image, containers can't
access it.

---

## ‚úÖ Switching to `ENV`

To make the variable visible **in containers**, use:

```dockerfile
ENV curl_bin="curl"

RUN apt -y update && apt -y install $curl_bin
```

Then rebuild:

```bash
docker build -t my-env-image .
```

Try the same echo test:

```bash
docker run --rm --entrypoint sh my-env-image -c 'echo $curl_bin'
```

**Output:** `curl`

‚úîÔ∏è The variable is now available to the container.

---

## üîÅ Overriding ENV at Runtime

You can **override the environment variable** with `-e`:

```bash
docker run --rm -e curl_bin=wget --entrypoint sh my-env-image -c 'echo $curl_bin'
```

**Output:** `wget`

‚úÖ This proves that `ENV` is flexible **during container startup**.

---

## üß† Recap: Order and Scope Rules

### Rule 1: Define variables **before** using them in `RUN`

```dockerfile
ARG curl_bin="curl"
RUN apt install $curl_bin  # ‚úÖ Works

RUN apt install $curl_bin  # ‚ùå If ARG is below this
ARG curl_bin="curl"
```

### Rule 2: You **cannot** use ARG or ENV in `ENTRYPOINT` or `CMD` unless they‚Äôre expanded by a shell script.

```dockerfile
ENTRYPOINT ["echo", "$curl_bin"]  # ‚ùå Will not be expanded
```

‚úÖ Better approach:

- Write a shell script wrapper (`entrypoint.sh`)
- Expand environment variables inside it

---

## When to Use What?

| Use Case                                       | Use `ARG` | Use `ENV` |
| ---------------------------------------------- | --------- | --------- |
| Install different versions at build time       | ‚úÖ        | ‚ùå        |
| Pass default settings for runtime config       | ‚ùå        | ‚úÖ        |
| Share a value between multiple `RUN` commands  | ‚úÖ        | ‚úÖ        |
| Make variables visible inside the container    | ‚ùå        | ‚úÖ        |
| Secure sensitive build-only secrets (temp use) | ‚úÖ        | ‚ùå        |
| Use in `docker run -e KEY=value`               | ‚ùå        | ‚úÖ        |

---

## üß™ Example Dockerfile: ARG + ENV

```dockerfile
# Base image
FROM ubuntu:latest

# Build-time variable
ARG curl_bin="curl"

# Runtime variable
ENV ENVIRONMENT="production"

# Install using ARG
RUN apt-get update && apt-get install -y $curl_bin

# Use ENV in app behavior
CMD ["sh", "-c", "echo Environment is $ENVIRONMENT"]
```

---

## ‚ùì Questions and Answers

### Q1: Can `ARG` be used in `ENTRYPOINT` or `CMD`?

No. ARG is discarded after build. Use `ENV` or expand using shell scripts.

---

### Q2: What happens if I use both `ARG` and `ENV`?

They can work together:

```dockerfile
ARG default_env="staging"
ENV ENVIRONMENT=$default_env
```

- You can override `default_env` with `--build-arg`
- `ENVIRONMENT` becomes available at runtime

---

### Q3: Can I see what build args were used?

No. Build args do **not** get stored in the final image for security reasons.

---

### Q4: Can I use ARG in `COPY` or `ADD`?

‚úÖ Yes, in later Docker versions:

```dockerfile
ARG app_dir=/app
COPY . ${app_dir}
```

---

## üîö Summary

| Instruction | Purpose              | Scope            | Overrides      |
| ----------- | -------------------- | ---------------- | -------------- |
| `ARG`       | Build-time parameter | Docker build     | `--build-arg`  |
| `ENV`       | Runtime config       | Docker container | `-e` / `--env` |

To use defaults:

- Use `ARG name=value` or `ENV name=value`

To override:

- `ARG`: use `docker build --build-arg`
- `ENV`: use `docker run --env` or `-e`

---

Use `ARG` to **control builds**, and `ENV` to **configure running containers**.
Understanding both is essential to writing flexible and production-ready
Dockerfiles.
