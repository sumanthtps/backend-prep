---
id: docker-container-privileges-capabilities
title: Docker advanced - Extending Container Privileges with Capabilities
sidebar_position: 60
---

## Summary

This section explains how to control and restrict container privileges using **Linux capabilities**, **Docker's `--cap-add` and `--cap-drop` flags**, the `--privileged` mode, and the `--device` flag. It demonstrates security risks when containers run with excessive permissions and offers safe alternatives.

---

## Key Concepts

### 1. **What Are Linux Capabilities?**

Linux capabilities are fine-grained permissions that break up the all-powerful `root` privileges into smaller units. Instead of giving full root access, containers can be granted only specific capabilities they need.

📖 [man 7 capabilities](https://man7.org/linux/man-pages/man7/capabilities.7.html)

Examples:
- `CAP_CHOWN`: Change file ownership
- `CAP_NET_ADMIN`: Configure network interfaces
- `CAP_SYS_TIME`: Set system time

![Linux Capabilities Diagram](https://opensource.com/sites/default/files/uploads/linux-capabilities-diagram.png)

---

### 2. **Default Capabilities in Docker**

By default, Docker provides containers with a **minimal set** of capabilities. This makes them useful yet safe. You can view the default set [here](https://docs.docker.com/engine/security/capabilities/).

Default includes:
- `CHOWN`, `DAC_OVERRIDE`, `FOWNER`, etc.

---

### 3. **Restricting Capabilities with `--cap-drop`**

You can remove specific capabilities using:

```bash
docker run --cap-drop=CHOWN alpine ...
````

If the app tries to use `chown`, it will fail with a **Permission denied** error.

---

### 4. **Adding Capabilities with `--cap-add`**

If your app needs a capability that is not enabled by default:

```bash
docker run --cap-add=NET_ADMIN alpine ...
```

You can also **combine** both:

```bash
docker run --cap-drop=ALL --cap-add=CHOWN ...
```

✅ This pattern is **strongly recommended** for secure container builds.

---

### 5. **Device Access via `--device`**

Use `--device` to allow access to physical devices like USB, GPU:

```bash
docker run --device=/dev/snd:/dev/snd ...
```

Only that specific device is exposed to the container.

---

### 6. **The `--privileged` Flag (⚠️ Dangerous)**

Gives **ALL** capabilities and device access to the container. It's equivalent to **bare-metal root access**.

```bash
docker run --privileged ...
```

> ✅ Use only for trusted containers or system-level tasks like DinD (Docker in Docker).

---

### 7. **Demonstration: Escaping File System with `--privileged`**

A privileged container was able to:

* List host block devices
* Mount host root filesystem
* Delete files on host

**Visual Example**:

![Privileged container mounting host](https://raw.githubusercontent.com/docker-library/docs/master/alpine/logo.png)

> ⚠️ **This bypasses isolation** and can destroy production environments.

---

## Missing or Implicit Concepts Explained

| Concept                       | Explanation                                                                                                                                      |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| **PID 1 Signal Handling**     | Without proper signal propagation (like `tini` or `init`), processes inside containers might not respond to `SIGTERM`, causing zombie processes. |
| **tini process supervisor**   | A minimal init system that ensures child processes handle signals correctly. Use `--init` flag in Docker to enable.                              |
| **Least privilege principle** | Grant only necessary capabilities (via `--cap-add`) and drop all others (`--cap-drop=ALL`).                                                      |
| **Docker Device Isolation**   | By default, Docker restricts access to devices under `/dev`. Use `--device` to expose specific ones.                                             |
| **capabilities(7)**           | Linux kernel concept of breaking superuser powers into distinct flags (CAP\_\*), used in POSIX-compliant systems.                                |

---

## MCQs with Detailed Explanations

### **Question 1:**

What does `--cap-drop=CHOWN` do when added to a `docker run` command?

**Options:**
A. Gives the container permission to change file ownership
B. Prevents the container from changing file ownership
C. Prevents the container from accessing /tmp
D. Runs the container with `nobody` user

**Correct Answer:**
✅ **B. Prevents the container from changing file ownership**

**Explanation:**

* Dropping `CAP_CHOWN` removes the ability to change file ownership using `chown`.
* Option A is opposite.
* Option C is unrelated.
* Option D is a user setting, not a capability.

---

### **Question 2:**

What does the `--privileged` flag do?

**Options:**
A. Disables all capabilities in a container
B. Enables GPU support only
C. Grants access to all devices and capabilities
D. Enables network ports

**Correct Answer:**
✅ **C. Grants access to all devices and capabilities**

**Explanation:**

* `--privileged` disables all security restrictions (AppArmor, seccomp, capabilities).
* Option A is wrong — it *adds* capabilities, not removes.
* Option B is partial — it grants access to GPU **and all other devices**.
* Option D is a networking topic.

---

### **Question 3:**

Which combination enforces the principle of least privilege for a container needing only `chown`?

**Options:**
A. `--cap-add=CHOWN`
B. `--cap-drop=ALL`
C. `--cap-add=CHOWN --cap-drop=ALL`
D. `--privileged`

**Correct Answer:**
✅ **C. `--cap-add=CHOWN --cap-drop=ALL`**

**Explanation:**

* This removes everything (`--cap-drop=ALL`) and adds only what's needed (`CHOWN`).
* A adds it, but doesn’t remove others.
* B removes all, but doesn’t add `CHOWN` back.
* D is insecure and does the opposite.

---

### **Question 4:**

What does `--device=/dev/snd:/dev/snd` do?

**Options:**
A. Grants full host access
B. Mounts `/dev/snd` from host to container
C. Creates a fake device
D. Runs a GPU container

**Correct Answer:**
✅ **B. Mounts `/dev/snd` from host to container**

**Explanation:**

* The `--device` flag gives direct access to host hardware.
* Option A is false unless used with `--privileged`.
* Option C is unrelated to `--device`.
* Option D is specific — but `/dev/snd` is a sound device, not GPU.

---

### **Question 5:**

Why is it risky to use `--privileged` in production?

**Options:**
A. It disables container networking
B. It prevents access to host disks
C. It allows full host control
D. It removes capabilities

**Correct Answer:**
✅ **C. It allows full host control**

**Explanation:**

* `--privileged` is equivalent to giving full root-level access.
* A is false; networking is unaffected.
* B is false; it *enables* access.
* D is wrong; it grants **all** capabilities.

---

## INFO PANEL

> 💡 **Best Practices:**
>
> * Avoid `--privileged` unless absolutely necessary.
> * Use `--cap-drop=ALL` and add back only what you need.
> * Use `--device` selectively for GPU, USB, sound, etc.
> * Use `--init` or Tini to ensure proper process termination.
> * Always test with non-root users if possible (`USER appuser` in Dockerfile).

