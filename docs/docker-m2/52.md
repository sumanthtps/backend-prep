---

id: intro-to-container-storage
title: Introduction to Container Storage and Volumes
sidebar_label: Intro to Container Storage
sidebar_position: 76
---------------------

## Summary

Containers are often seen as ephemeral, but most applications need **persistent storage**. This section introduces how Docker solves that problem through **Volumes** and **Bind Mounts**. It also explores how **overlay filesystems**, **volume drivers**, and **mount options** come together to support durable storage across container restarts.

---

## Key Concepts

### ❓ What happens to container storage by default?

- Containers use a **union (overlay) filesystem** combining:

  - Read-only layers from the image
  - A writable layer for changes

- **When a container stops or is deleted,** this writable layer is **lost**.

### 🧠 Why is this a problem?

- Stateless apps (e.g., a Python web server) might not care.
- **Stateful apps like databases** (PostgreSQL, MySQL, etc.) will **lose all
  data** unless storage is preserved.
- Restarting such containers without persistence can cause **data loss** or
  **downtime**.

### ✅ Docker's Solution: **Volumes**

- A **volume** is a folder **outside** the container's lifecycle.
- It allows **persistent, sharable, and safe** storage.

---

## How Volumes Work

### 🔧 Internals:

- When you **mount a volume** into a container:

  - Docker maps a folder **on the host** into a **mount point inside the
    container**.
  - This folder's lifecycle is managed by a **volume driver**.

### 📦 Volume Drivers:

- Volume drivers define **how and where** volumes are created and managed.
- Docker uses the **local driver** by default.

#### 🏠 `local` volume driver:

- Creates directories inside Docker's storage root
  (`/var/lib/docker/volumes/...`)
- Volumes are stored in **host file system**.
- Can also mount:

  - **NFS shares**
  - **CIFS/Samba shares**
  - **Block devices** using `type=device`

```bash
docker volume create \
  --driver local \
  --opt type=nfs \
  --opt o=addr=192.168.1.100,nolock,soft,rw \
  --opt device=:/exported/path \
  my-nfs-volume
```

#### ⚠️ Official Drivers (Legacy Warning):

- DockerHub has a list of volume drivers.
- Many are **outdated or unmaintained**.
- Recommended to stick with:

  - **Local volumes**
  - **Bind mounts** (covered later)

---

## Advantages of Using Volumes

| Feature                  | Volumes                     | Overlay FS (default) |
| ------------------------ | --------------------------- | -------------------- |
| Data persists after stop | ✅ Yes                      | ❌ No                |
| Shared across containers | ✅ Yes                      | ❌ No                |
| Easy backups & restores  | ✅ Yes                      | ❌ No                |
| OS-level performance     | ✅ High (no union overhead) | ❌ Slower            |
| Suitable for production  | ✅ Yes                      | ❌ No                |

---

## Notes

> 📌 **Overlay File Systems (aufs/overlay2)** Docker uses overlay file systems
> like **OverlayFS** or **AUFS** to compose images + container changes. But
> these are **temporary** for the container's lifecycle.

> 💡 **Best Practice** Use **volumes** for persistent application data (like
> `/var/lib/mysql`) instead of writing to the container filesystem.

---

## Questions and Answers

### Q1: Why doesn’t container storage persist by default?

**A:** Because Docker containers use an **overlay file system** where changes
are discarded once the container is removed or stopped.

### Q2: What are Docker volumes used for?

**A:** Volumes are used for **persistent, sharable** storage that lives beyond
the lifecycle of a container.

### Q3: What’s the default volume driver in Docker?

**A:** The `local` volume driver.

### Q4: Can `local` driver support remote filesystems?

**A:** Yes. It can mount **NFS**, **CIFS**, or even **block devices** via
options.

---

## Next Topics

- Mounting volumes with `--mount` and `-v`
- Bind mounts vs volumes
- Inspecting volume content and path
- Volume data import/export techniques

---
