---

title: Configuring Docker to Enable Debug Logging and Understanding `docker pull`
sidebar_position: 42
---------------------

## Introduction

Docker retrieves images from registries using the `docker pull` command. To fully understand the process, you need **debug logging enabled** to see how Docker interacts with registries, downloads image layers, and stores them on disk.

---

## Enabling Debug Logging

Docker doesn’t show debug logs by default, so we must configure the daemon.

### 1. Access the Docker Engine Environment

- **Mac (Lima VM):**

  ```bash
  limactl shell docker
  ```

- **Windows (WSL):** Open Ubuntu shell in Terminal.

- **Docker Desktop:**

  ```bash
  docker run -it --rm --privileged --pid=host justincormack/nsenter1
  ```

- **Native Linux:** Use your terminal directly.

---

### 2. Create/Edit `/etc/docker/daemon.json`

Check for file:

```bash
stat /etc/docker/daemon.json
```

Enable debug logging:

```bash
sudo sh -c 'echo "{\"debug\": true}" > /etc/docker/daemon.json'
```

Verify:

```bash
cat /etc/docker/daemon.json
```

Expected content:

```json
{
  "debug": true
}
```

---

### 3. Restart Docker

- Ubuntu/Debian:

  ```bash
  sudo service docker restart
  ```

- Systemd:

  ```bash
  sudo systemctl restart docker
  ```

---

## Streaming Docker Logs

On Ubuntu with Systemd:

```bash
sudo journalctl -fu docker
```

Alternative (SysVinit):

```bash
sudo tail -f /var/log/docker.log
```

---

## Performing a `docker pull`

In a second terminal:

```bash
docker pull redis:latest
```

### What Happens Behind the Scenes:

1. **Docker CLI → Docker Engine**

   - The CLI makes an HTTP POST request to the local Docker daemon.

2. **Docker Engine → Registry**

   - Contacts Docker Hub (`registry-1.docker.io`) for image metadata.

3. **Tag Resolution**

   - `redis:latest` resolved to a content digest (SHA256).

4. **Layer Downloads**

   - Each layer is pulled in parallel.
   - Logs show:

     ```
     pulling blob sha256:<layer-id>
     ```

5. **Extraction**

   - Layers are decompressed.
   - If `unpigz` is not installed, Docker falls back to `tar`.
   - Extracted into `/var/lib/docker/overlay2`.

6. **Lease and Content Digest**

   - Containerd assigns the image a content digest and a lease internally.

7. **Image Ready**

   - Once all layers are extracted, the image is stored locally.

---

## Key Points

- Debug mode reveals every network call, layer pull, and extraction step.
- Docker Hub is the default registry, but any OCI-compatible registry works.
- Layers are identified by content hashes, enabling caching and reuse.

---

## Questions and Answers

### Q1: Why does Docker use `tar` during pull?

**A:** Layers are stored as compressed tar files. Docker extracts them into
directories for container use.

---

### Q2: What is `unpigz`?

**A:** A parallel gzip decompression tool. Docker uses it for faster extraction
if available.

---

### Q3: Where are pulled layers stored?

**A:** Under `/var/lib/docker/overlay2` (or the storage driver directory in
use).

---

### Q4: What is a content digest?

**A:** A SHA256 hash uniquely identifying the image manifest and its layers.

---

### Q5: Why stream logs with `journalctl -fu docker`?

**A:** It shows real-time debug logs of Docker engine activity as you pull
images.
